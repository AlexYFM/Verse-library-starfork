
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Creating Scenario in Verse &#8212; verse 0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script src="_static/jquery.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Agent" href="agent.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="creating-scenario-in-verse">
<h1>Creating Scenario in Verse<a class="headerlink" href="#creating-scenario-in-verse" title="Permalink to this heading"></a></h1>
<p>The page provides an intuition about how to create scenarios in Verse. An interaction tutorial with more detailed instructions are provided in <a class="reference external" href="https://github.com/AutoVerse-ai/Verse-library/blob/main/tutorial/tutorial.ipynb">this jupyter notebook</a>.</p>
<p>A Verse scenario is defined by a map, a set of agents and , if there exist multiple agents, a sensor.</p>
<p>In this section, we are going to look at how to create a simple scenario in Verse. In this scenario we will have a drone following a straight track and will avoid by moving upwards to avoid a static obstacle at known position in the track.</p>
<section id="instantiate-map">
<h2>Instantiate Map<a class="headerlink" href="#instantiate-map" title="Permalink to this heading"></a></h2>
<p>The map of a scenario specifies the tracks that the agents can follow. In this example, we will only look at a simple map with two types of tracks: 1) type <code>T0</code>, which describe straight track that align with x-axis and 2) type <code>TAvoidUp</code>, which describes set of tracks with upward direction that the agent can follow while avoiding the obstacle. The types of tracks will also be referred as track modes in later sections. We will discuss in detail how to create maps in <a class="reference internal" href="map.html"><span class="doc">Map</span></a>. In this part of the document, we will import a pre-defined map.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tutorial_map</span> <span class="kn">import</span> <span class="n">M3</span>

<span class="n">map1</span> <span class="o">=</span> <span class="n">M3</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="creating-agent">
<h2>Creating Agent<a class="headerlink" href="#creating-agent" title="Permalink to this heading"></a></h2>
<p>To create such a scenario in Verse, we first need to create an agent for Verse. An agent in Verse is defined by a set of tactical modes, a decision logic to determine the transition between tactical modes, and a flow function that defines continuous evolution. The agent’s tactical mode and decision logic are provided as python code strings and the flow function is provided as a python function.</p>
<p>The tactical mode of the agents corresponds to an agent’s decision. For example, in this drone avoidance example, the tactical mode for the agent can be <code>Normal</code> and <code>AvoidUp</code>. The decision logic also need to know the available track modes from the map. The tactical modes and track modes are provided as <code>Enums</code> to Verse.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>


<span class="k">class</span> <span class="nc">CraftMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">Normal</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">AvoidUp</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TrackMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">TAvoidUp</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</pre></div>
</div>
<p>We also require the user to provide the continuous and discrete variables of the agents together with the decision logic. The variables are provided inside class with name <code>State</code>. Variables end with <code>_mode</code> will be identify by verse as discrete variables. In the example below, <code>craft_mode</code> and <code>track_mode</code> are the discrete variables and <code>x</code>, <code>y</code>, <code>z</code>, <code>vx</code>, <code>vy</code>, <code>vz</code> are the continuous variables. The type hints for the discrete variables are necessary to associate discrete variables with the tactical modes and lane modes defined above</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">vx</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">vy</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">vz</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">craft_mode</span><span class="p">:</span> <span class="n">CraftMode</span>
    <span class="n">track_mode</span><span class="p">:</span> <span class="n">TrackMode</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">craft_mode</span><span class="p">,</span> <span class="n">track_mode</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>The decision logic describe for an agent takes as input its current state and the (observable) states of the other agents if there’s any, and updates the tactical mode of the ego agent. In this example, the decision logic is traight forward: When the x position of the drone is close to the obstacle (20m), the drone will start moving upward. There’s no other agents in this scenario. The decision logic of the agent can be written in an expressive subset of Python inside function <code>decisionLogic</code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="k">def</span> <span class="nf">decisionLogic</span><span class="p">(</span><span class="n">ego</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">track_map</span><span class="p">):</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ego</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ego</span><span class="o">.</span><span class="n">craft_mode</span> <span class="o">==</span> <span class="n">CraftMode</span><span class="o">.</span><span class="n">Normal</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ego</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="nb">next</span><span class="o">.</span><span class="n">craft_mode</span> <span class="o">=</span> <span class="n">CraftMode</span><span class="o">.</span><span class="n">AvoidUp</span>
            <span class="nb">next</span><span class="o">.</span><span class="n">track_mode</span> <span class="o">=</span> <span class="n">track_map</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">ego</span><span class="o">.</span><span class="n">track_mode</span><span class="p">,</span> <span class="n">ego</span><span class="o">.</span><span class="n">craft_mode</span><span class="p">,</span> <span class="n">CraftMode</span><span class="o">.</span><span class="n">AvoidUp</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">next</span>
</pre></div>
</div>
<p>We incoperate the above definition of tactical modes and decision logic into code strings and combine it with an imported agent flow, we can then obtain the agent for this sceanrio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tutorial_agent</span> <span class="kn">import</span> <span class="n">DroneAgent</span>

<span class="n">drone1</span> <span class="o">=</span> <span class="n">DroneAgent</span><span class="p">(</span><span class="s2">&quot;drone1&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;dl_sec1.py&quot;</span><span class="p">,</span> <span class="n">t_v_pair</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">box_side</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>More details about how agents works in Verse are described in <a class="reference internal" href="agent.html"><span class="doc">Agents</span></a></p>
</section>
<section id="creating-scenario">
<h2>Creating Scenario<a class="headerlink" href="#creating-scenario" title="Permalink to this heading"></a></h2>
<p>With the agent and map defined, we can now define the scenario.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">verse.scenario</span> <span class="kn">import</span> <span class="n">Scenario</span>

<span class="n">scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">()</span>
</pre></div>
</div>
<p>We can set the initial condition of the agent and add the agent</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drone1</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">(</span><span class="n">CraftMode</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">TrackMode</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">scenario</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">drone1</span><span class="p">)</span>
</pre></div>
</div>
<p>and set the map for the sceanrio</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span><span class="o">.</span><span class="n">set_map</span><span class="p">(</span><span class="n">map1</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we only have one agent in the scenario, we don’t need to specify a sensor.</p>
<p>We can then compute simulation traces or reachable states for the scenario</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">traces_simu</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">traces_veri</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<p>We can visualize the results using functions provided with Verse</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">verse.plotter.plotter3D</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">verse.plotter.plotter2D</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">reachtube_tree</span><span class="p">(</span><span class="n">traces_veri</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">pv</span><span class="o">.</span><span class="n">set_jupyter_backend</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot3dMap</span><span class="p">(</span><span class="n">map1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot3dReachtube</span><span class="p">(</span><span class="n">traces_veri</span><span class="p">,</span> <span class="s2">&quot;drone1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="s2">&quot;#e0e0e0&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The visualized result looks like</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p>z vs t plot</p></th>
<th class="head text-center"><p>x,y,z plot</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="" src="_images/newplot.png" /></p></td>
<td class="text-center"><p><img alt="" src="_images/output.png" /></p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">verse</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating Scenario in Verse</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#instantiate-map">Instantiate Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-agent">Creating Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-scenario">Creating Scenario</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="map.html">Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensor.html">Sensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="scenario.html">Scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html#reachtubes">Reachtubes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_autosummary/verse.html">verse</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="getting_started.html" title="previous chapter">Getting Started</a></li>
      <li>Next: <a href="agent.html" title="next chapter">Agent</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Yangge Li, Haoqing Zhu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/creating_scenario_in_verse.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>